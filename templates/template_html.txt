{#- Generate a HTML report -#}
{#- See https://jinja.palletsprojects.com/en/2.11.x/templates/ -#}
{#- See https://jinja.palletsprojects.com/en/2.11.x/templates/#whitespace-control -#}
<!DOCTYPE html>
<html>
<head>
<title>Report</title>
<style>
    body {
        font: normal 12px Consolas, Arial, sans-serif;
    }
    table {
        width: 100%;
    }
    th {
        text-align: left;
        vertical-align: middle;
    }  
    td {
        text-align: left;
        vertical-align: middle;
    }
    .failed{
       color: red;
       font: bold 14px Consolas, Arial, sans-serif;
    }  
    .passed{
       color: green;
       font: normal 14px Consolas, Arial, sans-serif;
    }       
</style
</head>
<body>
<i>Report generated on {{ util_date.strftime("%Y-%m-%d") }}.</i>
<h1>Files reviewed</h1>
<ul>
{% for analysis_data in data.analysis_data_collection %}
    <li><a href="#{{ util_file.basename(analysis_data.config_file_name) }}">{{ util_file.basename(analysis_data.config_file_name) }}</a></li>
{% endfor %}
</ul>

<h1>Results</h1>
{% for analysis_data in data.analysis_data_collection %}

    {% set success_validation_points = data.audit_rules_passed[analysis_data.config_file_name] %}
    {% set check_total_count = success_validation_points|length + analysis_data.issue_datas|length %}

    <a id="{{ util_file.basename(analysis_data.config_file_name) }}"><h2>Configuration file: {{ util_file.basename(analysis_data.config_file_name) }}</h2></a>
    <h3>Server type was {{ analysis_data.server_type.name }}.</h3>
    <h3>{{ analysis_data.issue_datas|length }} issues found on {{ check_total_count }} points validated.</h3>

    <table>
        <thead>
            <tr>
                <th style="width:5%;">Rule ID</th>
                <th style="width:10%;">CIS version</th>
                <th style="width:7%;">Pass/Fail</td>
                <th>Check result</th>
            </tr>
        </thead>
        
        <tbody>
            {% for issue_data in analysis_data.issue_datas %}
            <tr>
                <td>{{ issue_data.rule_id }} </td>
                <td>{{ issue_data.CIS_version }} </td>
                <td class="failed">&#10006;</td>
                <td>{{ issue_data.details }} </td>
            </tr>
            {% endfor %}

            {% for point in success_validation_points %}
            <tr>
                <td>{{ point.rule_id }} </td>
                <td>{{ point.CIS_version }} </td>
                <td class="passed">&#10004;</td>
                <td>-</td>
            </tr>
            {% endfor %}
        </tbody>

    </table>
{% endfor %}
</body>
</html> 